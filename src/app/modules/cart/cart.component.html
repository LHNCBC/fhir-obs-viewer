<div class="v-box">
  <div class="spacer"></div>
  <div class="h-box">
    <b>{{pluralFormOfRecordType}} in Cart:</b>
  </div>
  <div class="spacer"></div>

  <ng-container *ngIf="records.length > 0; else emptyTemplate">
    <label class="info" *ngIf="resourceType === 'ResearchStudy'">
      <span class="info-icon" aria-hidden="true"></span>
      Patients will be added to the cohort if they participate in one of the studies in the cart.</label>
    <div class="spacer" *ngIf="resourceType === 'ResearchStudy'"></div>
    <div class="v-box list" [class.list--tree-view]="isTree()">
      <div class="v-box list-header">
        <div class="h-box switch-group" *ngIf="isTree()">
          <mat-radio-group [(ngModel)]="cart.logicalOperator[resourceType]"
                           aria-label="Select an operator to combine criteria">
            <mat-radio-button value="and">AND</mat-radio-button>
            <mat-radio-button value="or">OR</mat-radio-button>
          </mat-radio-group>
          <div class="spacer"></div>
          <label class="info">
            <span class="info-icon" aria-hidden="true"></span>
            Patients will be added to the cohort if they have all (AND) or one of (OR) the variables from the cart.</label>
        </div>
        <div class="h-box list-title">
          <div class="list-toolbar"></div>
          <label class="cell cell-{{resourceType}}-{{column.element}}" *ngFor="let column of columnDescriptions">{{column.displayName}}</label>
          <label class="cell cell-Variable-constraint" *ngIf="resourceType === 'Variable'">Value constraint</label>
        </div>
      </div>
      <div class="v-box list-body">
        <div class="h-box list-item" *ngFor="let record of records">
          <div class="condition-label" *ngIf="isTree()">{{cart.logicalOperator[resourceType]}}</div>
          <div class="list-toolbar">
            <button type="button" mat-icon-button class="remove-btn" (click)="removeRecordFromCart(resourceType, record)">
              <mat-icon svgIcon="clear"></mat-icon>
            </button>
          </div>
          <label class="cell cell-{{resourceType}}-{{column.element}}"
                 *ngFor="let column of columnDescriptions">
            <app-ellipsis-text>{{cells[record.id][column.element] || '&nbsp;'}}</app-ellipsis-text>
          </label>
          <ng-container *ngIf="resourceType === 'Variable'" [ngSwitch]="!cart.getVariableType(record.id)">
            <div class="cell cell-Variable-constraint h-box" *ngSwitchCase="true"><label>Loading...</label>&nbsp;<mat-spinner [diameter]="30"></mat-spinner></div>
            <ng-container [ngSwitch]="cart.getVariableType(record.id)" *ngSwitchDefault>
              <label class="cell cell-Variable-constraint" *ngSwitchCase="'empty'">No observations for this variable.</label>
              <label class="cell cell-Variable-constraint" *ngSwitchCase="'error'">Error loading observations.</label>
              <app-observation-test-value
                  *ngSwitchDefault
                  class="cell cell-Variable-constraint"
                  [(ngModel)]="cart.variableData[record.id].value"
                  [observationCodes]="[record.id]"
                  [datatype]="cart.getVariableType(record.id)">
              </app-observation-test-value>
            </ng-container>
          </ng-container>
        </div>
      </div>
    </div>
  </ng-container>
  <ng-template #emptyTemplate>
    <label>No {{pluralFormOfRecordType.toLowerCase()}} in the cart. Select the {{pluralFormOfRecordType.toLowerCase()}} for which you want to build a cohort of patients.</label>
  </ng-template>
</div>
