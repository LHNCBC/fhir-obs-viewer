<form [formGroup]="form">
  <div class="test-value">
    <mat-form-field *ngIf="!datatype">
      <mat-label>Comparator</mat-label>
      <mat-select formControlName="testValueComparator">
        <mat-optgroup label="numeric comparators">
          <mat-option *ngFor="let option of typeDescriptions.Quantity.searchValPrefixes"
                      (click)="setSelectedDatatype('Quantity')"
                      [value]="option[1]">{{option[0]}}</mat-option>
        </mat-optgroup>
        <mat-optgroup label="string comparators">
          <mat-option *ngFor="let option of typeDescriptions.String.modifiers"
                      (click)="setSelectedDatatype('String')"
                      [value]="option[1]">{{option[0]}}</mat-option>
        </mat-optgroup>
      </mat-select>
    </mat-form-field>
    <mat-form-field *ngIf="datatype && typeDescriptions[selectedDatatype].searchValPrefixes">
      <mat-label>Comparator</mat-label>
      <mat-select formControlName="testValuePrefix">
        <mat-option *ngFor="let option of typeDescriptions[selectedDatatype].searchValPrefixes"
                    [value]="option[1]">{{option[0]}}</mat-option>
      </mat-select>
    </mat-form-field>
    <mat-form-field *ngIf="datatype && typeDescriptions[selectedDatatype].modifiers">
      <mat-label>Comparator</mat-label>
      <mat-select formControlName="testValueModifier">
        <mat-option *ngFor="let option of typeDescriptions[selectedDatatype].modifiers"
                    [value]="option[1]">{{option[0]}}</mat-option>
      </mat-select>
    </mat-form-field>
    <mat-form-field *ngIf="selectedDatatype">
      <mat-label>Test value</mat-label>
      <ng-container [ngSwitch]="selectedDatatype">
        <app-autocomplete-parameter-value
            *ngSwitchCase="'CodeableConcept'"
            formControlName="testValue" placeholder="Select one or more"
            resourceType="Observation"
            [observationCodes]="observationCodes"
            columnName="value"
            expression="value"
            searchParameter="value-concept">
        </app-autocomplete-parameter-value>
        <input *ngSwitchCase="'Quantity'" type="number" step="any" matInput formControlName="testValue"
               placeholder="enter number value">
        <input *ngSwitchDefault type="text" matInput formControlName="testValue"
               placeholder="enter string value">
      </ng-container>
    </mat-form-field>

    <mat-form-field *ngIf="selectedDatatype && typeDescriptions[selectedDatatype].unit">
      <mat-label>Test value unit</mat-label>
      <app-observation-test-value-units
          formControlName="testValueUnit"
          [loincCodes]="loincCodes"
          placeholder="unit code">
      </app-observation-test-value-units>
    </mat-form-field>
  </div>
</form>
